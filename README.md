# Malware-Analysis-using-Wireshark

## Summary
This project focuses on analyzing network traffic generated by malware using Wireshark. The aim is to identify malicious patterns, detect anomalies, and understand the behavior of malware through packets inspection. By capturing and dissecting network traffic, this project highlights various techniques malware uses to communicate, exfiltrate data, or spread across networks.

## Key Objectives
- Capture network traffic associated with malware execution.
- Identify suspicious communication patterens (unusual protocols, port usage, etc)
### DNS Filter
![01](https://github.com/user-attachments/assets/35317cc3-cf72-41d1-8641-402ca454fd96)

#### -An indicator of this malware and what it is trying to do- 

When analyzing malware, looking at DNS traffic is crucial step because it can reveal what domains the malware is attempting to contact. In this case I find alot of "No such name" this message indicates that a DNS query was made, but the requested domain does not exist or is unreachable. 
Malware often tries to contact multiple domains.
Something interesting I find is a "wtfmyip.com" a public IP lookup service. An end user wont often do that but the reason a malware would is to identify the public IP address of the infected machine for reporting back to a C2 server or determine its geographical location. 
So already the combination of failed DNS queries and a successful lookup to wftmyip.com suggests the malware might be tying to figure out its external network position before continuing with further malicious actions.
### HTTP Request/Replies
![02 1](https://github.com/user-attachments/assets/4ae607cf-8325-4435-8f14-2d552be39d38)

Usually when you browse the web is done over a secure web port 443 not port 80. There might be a few applications that use 80 but malware often uses port 80 because unencrypted traffic is easier to inspect also attackers may rely on it when trying to mimic legitmate HTTP traffic, possibly to avoid detection. 

![04](https://github.com/user-attachments/assets/5481875a-8c24-46be-88a0-909ab007c0f0)

I've right clicked on the first one then go to follow and then tcp stream. The first thing to notice is the user agent is coming from curl and not using a standard user agent like chrome, firefox or mozilla where there would be a long user agent string but this one is short. User agents is where it introduces itself to the server and establishing some parameters. 
I also see the servers name is cowboy and all it returns is an ip address. 
![05](https://github.com/user-attachments/assets/1ea39d33-ed2f-4f41-a4b6-37d0903478b5)

#### What do we learn?
The malware is likely trying to identify the external IP address of the infected machine. This behavior is typical in the reconnaissance phase of the malware, where it gathers basic information about the environment it is running in. 

#### -Another indicator of this malware and what it is trying to do- 

With HTTP you can either GET traffic or POST traffic. I looked at the first one which is GET now I'll take a look at the POST traffics as there are a few.

![06](https://github.com/user-attachments/assets/35e62dc2-70af-4fd0-8483-bcfd6a326da7)

Straight away I see a more normal user agent but in the host section it shows an ip (36.89.106.69) whereas in most cases it would be a hostname like wireshark.org and so on. Also looking at the stuff POSTing to cowboy.I'll do a quick lookup of the ip address.

![03](https://github.com/user-attachments/assets/4d59297d-0e4d-4d8d-9a8b-2b7e86d2d022)

Now I know that we are sending data to Indonesia. Thats pretty strange who woud send that type of info to a random server in a foreign country.

#### What do we learn?
The malware appears to be gathering and exfiltrating sensitive data (formdata, billinfo, cardinfo) to a remote server. The switch from curl to a Mozilla user agent could indicate that the malware is adapting its behavior, switching from reconnaissance (finding the IP address) to an exfiltration phase where it sends sensitive data to a command-and-control (C2) server.

#### -Another indicator of this malware and what it is trying to do- 

![07](https://github.com/user-attachments/assets/f9ae51f3-6cc4-4654-b67d-6c5a7da2f1ea)

###### WinHTTP usage:
The malware is using winHTTP (a Window API) to send HTTP requests in a way that mimics legitimate Windows system activity.
###### POSTing process information:
The malware is collecting information about running processes and sending it to a remote server. 
###### Communication with Remote server:
The malware is sending the collected process list to a remote server hosted at the IP address 203.176.135.102 on port 8082. This server could be part of the malware's command and control (C2) 
#### What do we learn?
This malware is engaged in system reconnaissance (collecting process details) and sending this information to a remote C2 server.

#### -Another indicator of this malware and what it is trying to do- 

![09](https://github.com/user-attachments/assets/981d65af-1f3a-4f4c-bca1-7abe936b5629)
If I take a look at the first packet and see that the packet is 443 which is coming from 10.5.28.229. 
This could indicate the the client waas phished, they were either sent an email, a link or something they have executed. 
So in the first 3 packets I have SYN, SYN-ACK, ACK the three-way handshake. Then I have the "Client Hello". The client hello is the first packet of a TLS handshake, it happens after the TCP connection. The client is reaching out by establishing the parameters of an encrypted conversation.
In the image above we see some interesting findings;
#### 1. TLS 1.0 Version
- TLS 1.0 is an older version of the Transport Layer Security (TLS) protocol, which is used to establish secure connections over a network. Overwhelming traffic is TLS 1.2 or 1.3 so running old TLS 1.0 or 1.1 can be an indication that this is super old that needs to be patch or your dealing with malware. And if malware is using TLS 1.0 it could be avoiding detection were some security monitoring tools might not inspect or handle older protocols like TLS 1.0 as rigorously as newer protocols like TLS 1.2 or 1.3, making it easier for malware to hide its traffic.
#### 2. Cipher Suites using RSA
- RSA is an encryption algorithm used in older cipher suites, typically for key exchange and authentication. This means the client which could be malware is pro[osing to use RSA-based encryption to establish a secure session.

#### -Another indicator of this malware and what it is trying to do- 

![011](https://github.com/user-attachments/assets/d974cf8f-480d-496c-8029-a326d62a5cb2)

I clicked on the file name "cursor.png" to follow the packets by clicking conversation filter and going to TCP. The first thing I see is a handshake the client is reaching out and it Getting cursor.png, that was one of the files it was requesting. If I look at the first packet of the response.

![012](https://github.com/user-attachments/assets/6cfb57d8-5413-496c-99ef-983bfb65c05a)

The request is using a Host IP not a Host name. When we request it we see MZ is the initial part of the file header. And MZ are the initials of one of the gentlemen who created DOS, so MZ is at the start of every executable or binary file seen in the header information.
Also I see "This program cannot be run in DOS mode" this tells me that this is not a png file because that would be an image. Its actually retrieving an executable file thats being hidden behind the cursor.png filename.

#### -Another indicator of this malware and what it is trying to do-

![013](https://github.com/user-attachments/assets/7ab7ee9d-8349-4ac3-9a61-5eb6df54a06c)

I'll be using Zui, also known as Brim, a powerful open-source tool designed for analyzing network traffic and packet captures (PCAPSs). Brim helps visualize and filter network traffic, particularly large datasets, and is a popular tool for analyzing Zeek logs and PCAP files.

![015](https://github.com/user-attachments/assets/8226edcb-9da8-4836-8933-6100c9db42d1)

I open up the same PCAP we've been analyzing in Wireshark to Zui. If we take a look we'll see an alert "ET malware TrickBot" detection indicates that the network traffic Im analyzing may be associated with the TrickBot malware.

#### -Another indicator of this malware and what it is trying to do- 

## Final thoughts
The analysis revealed significant malicious activity, including failed DNS requests to suspicious domains and unencrypted HTTP traffic involving public IP retrievals and data exfiltration of sensitive information. Communication with a command-and-control (C2) server was observed, including system profiling data. The malware also attempted to use outdated and insecure TLS 1.0 encryption, further highlighting the compromise and its potential risks.

